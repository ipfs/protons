<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>protons | Protons</title><meta name="description" content="Documentation for Protons"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Protons</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../index.html">Protons</a></li><li><a href="protons.html">protons</a></li></ul><h1>Module protons</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><p><code>protons</code> is a high performance implementation of <a href="https://protobuf.dev/programming-guides/proto3/">Protocol Buffers v3</a>.</p>
<p>It transpiles code to TypeScript and supports BigInts for 64 bit types.</p>
<p>The <code>protons</code> module contains the code to compile <code>.proto</code> files to <code>.ts</code> files and <code>protons-runtime</code> contains the code to do serialization/deserialization to <code>Uint8Array</code>s during application execution.</p>
<p>Please ensure you declare them as the correct type of dependencies:</p>
<pre><code class="language-console"><span class="hl-0">$ npm install --save-dev protons</span><br/><span class="hl-0">$ npm install --save protons-runtime</span>
</code><button>Copy</button></pre>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><p>First generate your <code>.ts</code> files:</p>
<pre><code class="language-console"><span class="hl-0">$ protons ./path/to/foo.proto ./path/to/output.ts</span>
</code><button>Copy</button></pre>
<p>Then run tsc over them as normal:</p>
<pre><code class="language-console"><span class="hl-0">$ tsc</span>
</code><button>Copy</button></pre>
<p>In your code import the generated classes and use them to transform to/from bytes:</p>
<pre><code class="language-js"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./foo.js&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">foo</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-2">message:</span><span class="hl-0"> </span><span class="hl-3">&#39;hello world&#39;</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">encoded</span><span class="hl-0"> = </span><span class="hl-2">Foo</span><span class="hl-0">.</span><span class="hl-6">encode</span><span class="hl-0">(</span><span class="hl-2">foo</span><span class="hl-0">)</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">decoded</span><span class="hl-0"> = </span><span class="hl-2">Foo</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">encoded</span><span class="hl-0">)</span><br/><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-2">decoded</span><span class="hl-0">.</span><span class="hl-2">message</span><span class="hl-0">)</span><br/><span class="hl-7">// &#39;hello world&#39;</span>
</code><button>Copy</button></pre>
<a id="md:differences-from-protobufjs" class="tsd-anchor"></a><h2><a href="#md:differences-from-protobufjs">Differences from protobuf.js</a></h2><p>This module uses the internal reader/writer from <code>protobuf.js</code> as it is highly optimised and there&#39;s no point reinventing the wheel.</p>
<p>It does have one or two differences:</p>
<ol>
<li>Supports <code>proto3</code> semantics only</li>
<li>All 64 bit values are represented as <code>BigInt</code>s and not <code>Long</code>s (e.g. <code>int64</code>, <code>uint64</code>, <code>sint64</code> etc)</li>
<li>Unset <code>optional</code> fields are set on the deserialized object forms as <code>undefined</code> instead of the default values</li>
<li><code>singular</code> fields set to default values are not serialized and are set to default values when deserialized if not set - protobuf.js <a href="https://github.com/protobufjs/protobuf.js/issues/1468#issuecomment-745177012">diverges from the language guide</a> around this feature</li>
<li><code>map</code> fields can have keys of any type - protobufs.js <a href="https://github.com/protobufjs/protobuf.js/issues/1203#issuecomment-488637338">only supports strings</a></li>
<li><code>map</code> fields are deserialized as ES6 <code>Map</code>s - protobuf.js uses <code>Object</code>s</li>
</ol>
<a id="md:extra-features" class="tsd-anchor"></a><h2><a href="#md:extra-features">Extra features</a></h2><a id="md:limiting-the-size-of-repeatedmap-elements" class="tsd-anchor"></a><h3><a href="#md:limiting-the-size-of-repeatedmap-elements">Limiting the size of repeated/map elements</a></h3><p>To protect decoders from malicious payloads, it&#39;s possible to limit the maximum size of repeated/map elements.</p>
<p>You can either do this at compile time by using the <a href="https://github.com/protocolbuffers/protobuf/blob/6f1d88107f268b8ebdad6690d116e74c403e366e/docs/options.md?plain=1#L490-L493">protons.options</a> extension:</p>
<pre><code class="language-protobuf">message MyMessage {
  // repeatedField cannot have more than 10 entries
  repeated uint32 repeatedField = 1 [(protons.options).limit = 10];

  // stringMap cannot have more than 10 keys
  map&lt;string, string&gt; stringMap = 2 [(protons.options).limit = 10];
}
</code><button>Copy</button></pre>
<p>Or at runtime by passing objects to the <code>.decode</code> function of your message:</p>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">10</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-2">stringMap:</span><span class="hl-0"> </span><span class="hl-8">10</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-nested-messages-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-nested-messages-at-runtime">Limiting repeating fields of nested messages at runtime</a></h4><p>Sub messages with repeating elements can be limited in a similar way:</p>
<pre><code class="language-protobuf">message SubMessage {
  repeated uint32 repeatedField = 1;
}

message MyMessage {
  SubMessage message = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// the SubMessage can not have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-repeating-messages-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-repeating-messages-at-runtime">Limiting repeating fields of repeating messages at runtime</a></h4><p>Sub messages defined in repeating elements can be limited by appending <code>$</code> to the field name in the runtime limit options:</p>
<pre><code class="language-protobuf">message SubMessage {
 repeated uint32 repeatedField = 1;
}

message MyMessage {
  repeated SubMessage messages = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// max 5x SubMessages</span><br/><span class="hl-0">    </span><span class="hl-2">messages$</span><span class="hl-0">: {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// no SubMessage can have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-map-entries-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-map-entries-at-runtime">Limiting repeating fields of map entries at runtime</a></h4><p>Repeating fields in map entries can be limited by appending <code>$value</code> to the field name in the runtime limit options:</p>
<pre><code class="language-protobuf">message SubMessage {
 repeated uint32 repeatedField = 1;
}

message MyMessage {
  map&lt;string, SubMessage&gt; messages = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// max 5x SubMessages in the map</span><br/><span class="hl-0">    </span><span class="hl-2">messages$value</span><span class="hl-0">: {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// no SubMessage in the map can have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:overriding-64-bit-types" class="tsd-anchor"></a><h3><a href="#md:overriding-64-bit-types">Overriding 64 bit types</a></h3><p>By default 64 bit types are implemented as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt">BigInt</a>s.</p>
<p>Sometimes this is undesirable due to <a href="https://betterprogramming.pub/the-downsides-of-bigints-in-javascript-6350fd807d">performance issues</a> or code legibility.</p>
<p>It&#39;s possible to override the JavaScript type 64 bit fields will deserialize to:</p>
<pre><code class="language-protobuf">message MyMessage {
  repeated int64 bigintField = 1;
  repeated int64 numberField = 2 [jstype = JS_NUMBER];
  repeated int64 stringField = 3 [jstype = JS_STRING];
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">)</span><br/><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">bigintField</span><span class="hl-0">) </span><span class="hl-7">// bigint</span><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">numberField</span><span class="hl-0">) </span><span class="hl-7">// number</span><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">stringField</span><span class="hl-0">) </span><span class="hl-7">// string</span>
</code><button>Copy</button></pre>
<a id="md:missing-features" class="tsd-anchor"></a><h2><a href="#md:missing-features">Missing features</a></h2><p>Some features are missing <code>OneOf</code>s, etc due to them not being needed so far in ipfs/libp2p. If these features are important to you, please open PRs implementing them along with tests comparing the generated bytes to <code>protobuf.js</code> and <code>pbjs</code>.</p>
</div><div class="tsd-comment tsd-typography"></div></section><section class="tsd-panel tsd-typography"><a id="md:protons-" class="tsd-anchor"></a><h1><a href="#md:protons-">protons <!-- omit in toc --></a></h1><p><a href="https://ipfs.tech"><img src="https://img.shields.io/badge/project-IPFS-blue.svg?style=flat-square" alt="ipfs.tech"></a>
<a href="https://discuss.ipfs.tech"><img src="https://img.shields.io/discourse/https/discuss.ipfs.tech/posts.svg?style=flat-square" alt="Discuss"></a>
<a href="https://codecov.io/gh/ipfs/protons"><img src="https://img.shields.io/codecov/c/github/ipfs/protons.svg?style=flat-square" alt="codecov"></a>
<a href="https://github.com/ipfs/protons/actions/workflows/js-test-and-release.yml?query=branch%3Amain"><img src="https://img.shields.io/github/actions/workflow/status/ipfs/protons/js-test-and-release.yml?branch=main&style=flat-square" alt="CI"></a></p>
<blockquote>
<p>Protobuf to ts transpiler</p>
</blockquote>
<a id="md:about" class="tsd-anchor"></a><h1><a href="#md:about">About</a></h1><!--

!IMPORTANT!

Everything in this README between "# About" and "# Install" is automatically
generated and will be overwritten the next time the doc generator is run.

To make changes to this section, please update the  section
of src/index.js or src/index.ts

To experiment with formatting, please run "npm run docs" from the root of this
repo and examine the changes made.

-->

<p><code>protons</code> is a high performance implementation of <a href="https://protobuf.dev/programming-guides/proto3/">Protocol Buffers v3</a>.</p>
<p>It transpiles code to TypeScript and supports BigInts for 64 bit types.</p>
<p>The <code>protons</code> module contains the code to compile <code>.proto</code> files to <code>.ts</code> files and <code>protons-runtime</code> contains the code to do serialization/deserialization to <code>Uint8Array</code>s during application execution.</p>
<p>Please ensure you declare them as the correct type of dependencies:</p>
<pre><code class="language-console"><span class="hl-0">$ npm install --save-dev protons</span><br/><span class="hl-0">$ npm install --save protons-runtime</span>
</code><button>Copy</button></pre>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><p>First generate your <code>.ts</code> files:</p>
<pre><code class="language-console"><span class="hl-0">$ protons ./path/to/foo.proto ./path/to/output.ts</span>
</code><button>Copy</button></pre>
<p>Then run tsc over them as normal:</p>
<pre><code class="language-console"><span class="hl-0">$ tsc</span>
</code><button>Copy</button></pre>
<p>In your code import the generated classes and use them to transform to/from bytes:</p>
<pre><code class="language-js"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">Foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;./foo.js&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">foo</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-2">message:</span><span class="hl-0"> </span><span class="hl-3">&#39;hello world&#39;</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">encoded</span><span class="hl-0"> = </span><span class="hl-2">Foo</span><span class="hl-0">.</span><span class="hl-6">encode</span><span class="hl-0">(</span><span class="hl-2">foo</span><span class="hl-0">)</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">decoded</span><span class="hl-0"> = </span><span class="hl-2">Foo</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">encoded</span><span class="hl-0">)</span><br/><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-2">decoded</span><span class="hl-0">.</span><span class="hl-2">message</span><span class="hl-0">)</span><br/><span class="hl-7">// &#39;hello world&#39;</span>
</code><button>Copy</button></pre>
<a id="md:differences-from-protobufjs" class="tsd-anchor"></a><h2><a href="#md:differences-from-protobufjs">Differences from protobuf.js</a></h2><p>This module uses the internal reader/writer from <code>protobuf.js</code> as it is highly optimised and there&#39;s no point reinventing the wheel.</p>
<p>It does have one or two differences:</p>
<ol>
<li>Supports <code>proto3</code> semantics only</li>
<li>All 64 bit values are represented as <code>BigInt</code>s and not <code>Long</code>s (e.g. <code>int64</code>, <code>uint64</code>, <code>sint64</code> etc)</li>
<li>Unset <code>optional</code> fields are set on the deserialized object forms as <code>undefined</code> instead of the default values</li>
<li><code>singular</code> fields set to default values are not serialized and are set to default values when deserialized if not set - protobuf.js <a href="https://github.com/protobufjs/protobuf.js/issues/1468#issuecomment-745177012">diverges from the language guide</a> around this feature</li>
<li><code>map</code> fields can have keys of any type - protobufs.js <a href="https://github.com/protobufjs/protobuf.js/issues/1203#issuecomment-488637338">only supports strings</a></li>
<li><code>map</code> fields are deserialized as ES6 <code>Map</code>s - protobuf.js uses <code>Object</code>s</li>
</ol>
<a id="md:extra-features" class="tsd-anchor"></a><h2><a href="#md:extra-features">Extra features</a></h2><a id="md:limiting-the-size-of-repeatedmap-elements" class="tsd-anchor"></a><h3><a href="#md:limiting-the-size-of-repeatedmap-elements">Limiting the size of repeated/map elements</a></h3><p>To protect decoders from malicious payloads, it&#39;s possible to limit the maximum size of repeated/map elements.</p>
<p>You can either do this at compile time by using the <a href="https://github.com/protocolbuffers/protobuf/blob/6f1d88107f268b8ebdad6690d116e74c403e366e/docs/options.md?plain=1#L490-L493">protons.options</a> extension:</p>
<pre><code class="language-protobuf">message MyMessage {
  // repeatedField cannot have more than 10 entries
  repeated uint32 repeatedField = 1 [(protons.options).limit = 10];

  // stringMap cannot have more than 10 keys
  map&lt;string, string&gt; stringMap = 2 [(protons.options).limit = 10];
}
</code><button>Copy</button></pre>
<p>Or at runtime by passing objects to the <code>.decode</code> function of your message:</p>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">10</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-2">stringMap:</span><span class="hl-0"> </span><span class="hl-8">10</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-nested-messages-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-nested-messages-at-runtime">Limiting repeating fields of nested messages at runtime</a></h4><p>Sub messages with repeating elements can be limited in a similar way:</p>
<pre><code class="language-protobuf">message SubMessage {
  repeated uint32 repeatedField = 1;
}

message MyMessage {
  SubMessage message = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// the SubMessage can not have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-repeating-messages-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-repeating-messages-at-runtime">Limiting repeating fields of repeating messages at runtime</a></h4><p>Sub messages defined in repeating elements can be limited by appending <code>$</code> to the field name in the runtime limit options:</p>
<pre><code class="language-protobuf">message SubMessage {
 repeated uint32 repeatedField = 1;
}

message MyMessage {
  repeated SubMessage messages = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// max 5x SubMessages</span><br/><span class="hl-0">    </span><span class="hl-2">messages$</span><span class="hl-0">: {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// no SubMessage can have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:limiting-repeating-fields-of-map-entries-at-runtime" class="tsd-anchor"></a><h4><a href="#md:limiting-repeating-fields-of-map-entries-at-runtime">Limiting repeating fields of map entries at runtime</a></h4><p>Repeating fields in map entries can be limited by appending <code>$value</code> to the field name in the runtime limit options:</p>
<pre><code class="language-protobuf">message SubMessage {
 repeated uint32 repeatedField = 1;
}

message MyMessage {
  map&lt;string, SubMessage&gt; messages = 1;
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-2">limits:</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">messages:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// max 5x SubMessages in the map</span><br/><span class="hl-0">    </span><span class="hl-2">messages$value</span><span class="hl-0">: {</span><br/><span class="hl-0">      </span><span class="hl-2">repeatedField:</span><span class="hl-0"> </span><span class="hl-8">5</span><span class="hl-0"> </span><span class="hl-7">// no SubMessage in the map can have more than 5 repeatedField entries</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">})</span>
</code><button>Copy</button></pre>
<a id="md:overriding-64-bit-types" class="tsd-anchor"></a><h3><a href="#md:overriding-64-bit-types">Overriding 64 bit types</a></h3><p>By default 64 bit types are implemented as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt">BigInt</a>s.</p>
<p>Sometimes this is undesirable due to <a href="https://betterprogramming.pub/the-downsides-of-bigints-in-javascript-6350fd807d">performance issues</a> or code legibility.</p>
<p>It&#39;s possible to override the JavaScript type 64 bit fields will deserialize to:</p>
<pre><code class="language-protobuf">message MyMessage {
  repeated int64 bigintField = 1;
  repeated int64 numberField = 2 [jstype = JS_NUMBER];
  repeated int64 stringField = 3 [jstype = JS_STRING];
}
</code><button>Copy</button></pre>
<pre><code class="language-TypeScript"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-2">MyMessage</span><span class="hl-0">.</span><span class="hl-6">decode</span><span class="hl-0">(</span><span class="hl-2">buf</span><span class="hl-0">)</span><br/><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">bigintField</span><span class="hl-0">) </span><span class="hl-7">// bigint</span><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">numberField</span><span class="hl-0">) </span><span class="hl-7">// number</span><br/><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-6">info</span><span class="hl-0">(</span><span class="hl-4">typeof</span><span class="hl-0"> </span><span class="hl-2">message</span><span class="hl-0">.</span><span class="hl-2">stringField</span><span class="hl-0">) </span><span class="hl-7">// string</span>
</code><button>Copy</button></pre>
<a id="md:missing-features" class="tsd-anchor"></a><h2><a href="#md:missing-features">Missing features</a></h2><p>Some features are missing <code>OneOf</code>s, etc due to them not being needed so far in ipfs/libp2p. If these features are important to you, please open PRs implementing them along with tests comparing the generated bytes to <code>protobuf.js</code> and <code>pbjs</code>.</p>
<a id="md:install" class="tsd-anchor"></a><h1><a href="#md:install">Install</a></h1><pre><code class="language-console"><span class="hl-0">$ npm i protons</span>
</code><button>Copy</button></pre>
<a id="md:api-docs" class="tsd-anchor"></a><h1><a href="#md:api-docs">API Docs</a></h1><ul>
<li><a href="https://ipfs.github.io/protons/modules/protons.html">https://ipfs.github.io/protons/modules/protons.html</a></li>
</ul>
<a id="md:license" class="tsd-anchor"></a><h1><a href="#md:license">License</a></h1><p>Licensed under either of</p>
<ul>
<li>Apache 2.0, (<a href="LICENSE-APACHE">LICENSE-APACHE</a> / <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT (<a href="LICENSE-MIT">LICENSE-MIT</a> / <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a>)</li>
</ul>
<a id="md:contribute" class="tsd-anchor"></a><h1><a href="#md:contribute">Contribute</a></h1><p>Contributions welcome! Please check out <a href="https://github.com/ipfs/protons/issues">the issues</a>.</p>
<p>Also see our <a href="https://github.com/ipfs/community/blob/master/CONTRIBUTING_JS.md">contributing document</a> for more information on how we work, and about contributing in general.</p>
<p>Please be aware that all interactions related to this repo are subject to the IPFS <a href="https://github.com/ipfs/community/blob/master/code-of-conduct.md">Code of Conduct</a>.</p>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.</p>
<p><a href="https://github.com/ipfs/community/blob/master/CONTRIBUTING.md"><img src="https://cdn.rawgit.com/jbenet/contribute-ipfs-gif/master/img/contribute.gif" alt=""></a></p>
</section><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><h3 class="tsd-index-heading uppercase">Index</h3><section class="tsd-index-section"><h3 class="tsd-index-heading">Enumerations</h3><div class="tsd-index-list"><a href="../enums/protons.CODEC_TYPES.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-8"></use></svg><span>CODEC_<wbr/>TYPES</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Classes</h3><div class="tsd-index-list"><a href="../classes/protons.CodeError.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-128"></use></svg><span>Code<wbr/>Error</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Functions</h3><div class="tsd-index-list"><a href="../functions/protons.generate.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-64"></use></svg><span>generate</span></a>
</div></section></section></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><a href="#md:usage"><span>Usage</span></a></li><li><a href="#md:differences-from-protobufjs"><span>Differences from protobuf.js</span></a></li><li><a href="#md:extra-features"><span>Extra features</span></a></li><li><ul><li><a href="#md:limiting-the-size-of-repeatedmap-elements"><span>Limiting the size of repeated/map elements</span></a></li><li><ul><li><a href="#md:limiting-repeating-fields-of-nested-messages-at-runtime"><span>Limiting repeating fields of nested messages at runtime</span></a></li><li><a href="#md:limiting-repeating-fields-of-repeating-messages-at-runtime"><span>Limiting repeating fields of repeating messages at runtime</span></a></li><li><a href="#md:limiting-repeating-fields-of-map-entries-at-runtime"><span>Limiting repeating fields of map entries at runtime</span></a></li></ul></li><li><a href="#md:overriding-64-bit-types"><span>Overriding 64 bit types</span></a></li></ul></li><li><a href="#md:missing-features"><span>Missing features</span></a></li></ul><a href="#md:protons-"><span>protons </span></a><a href="#md:about"><span>About</span></a><ul><li><a href="#md:usage"><span>Usage</span></a></li><li><a href="#md:differences-from-protobufjs"><span>Differences from protobuf.js</span></a></li><li><a href="#md:extra-features"><span>Extra features</span></a></li><li><ul><li><a href="#md:limiting-the-size-of-repeatedmap-elements"><span>Limiting the size of repeated/map elements</span></a></li><li><ul><li><a href="#md:limiting-repeating-fields-of-nested-messages-at-runtime"><span>Limiting repeating fields of nested messages at runtime</span></a></li><li><a href="#md:limiting-repeating-fields-of-repeating-messages-at-runtime"><span>Limiting repeating fields of repeating messages at runtime</span></a></li><li><a href="#md:limiting-repeating-fields-of-map-entries-at-runtime"><span>Limiting repeating fields of map entries at runtime</span></a></li></ul></li><li><a href="#md:overriding-64-bit-types"><span>Overriding 64 bit types</span></a></li></ul></li><li><a href="#md:missing-features"><span>Missing features</span></a></li></ul><a href="#md:install"><span>Install</span></a><a href="#md:api-docs"><span>API <wbr/>Docs</span></a><a href="#md:license"><span>License</span></a><a href="#md:contribute"><span>Contribute</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>Protons</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>